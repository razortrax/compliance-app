generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accident_issue {
  id           String   @id
  issueId      String   @unique
  accidentDate DateTime
  location     String?
  severity     String
  reportNumber String?
  isReportable Boolean  @default(false)
  issue        issue    @relation(fields: [issueId], references: [id], onDelete: Cascade)
}

model consultant {
  id              String         @id
  partyId         String         @unique
  licenseNumber   String?
  specializations String[]
  yearsExperience Int?
  hourlyRate      Decimal?
  bio             String?
  isActive        Boolean        @default(true)
  isVerified      Boolean        @default(false)
  party           party          @relation(fields: [partyId], references: [id], onDelete: Cascade)
  consultation    consultation[]
}

model consultant_access_log {
  id                   String               @id
  consentId            String
  accessedAt           DateTime             @default(now())
  action               String
  resourceType         String
  resourceId           String?
  details              String?
  ipAddress            String?
  userAgent            String?
  data_sharing_consent data_sharing_consent @relation(fields: [consentId], references: [id], onDelete: Cascade)
}

model consultation {
  id                   String                @id
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  clientOrgId          String
  consultantId         String
  title                String
  description          String?
  consultationType     String
  status               String                @default("REQUESTED")
  urgency              String                @default("NORMAL")
  requestedAt          DateTime              @default(now())
  acceptedAt           DateTime?
  startDate            DateTime?
  endDate              DateTime?
  dataAccessExpiry     DateTime?
  agreedRate           Decimal?
  estimatedHours       Int?
  actualHours          Decimal?
  organization         organization          @relation(fields: [clientOrgId], references: [id])
  consultant           consultant            @relation(fields: [consultantId], references: [id])
  data_sharing_consent data_sharing_consent?
}

model data_sharing_consent {
  id                    String                  @id
  consultationId        String                  @unique
  consentGivenAt        DateTime                @default(now())
  consentGivenBy        String
  isActive              Boolean                 @default(true)
  revokedAt             DateTime?
  revokedBy             String?
  scopePermissions      Json
  consultant_access_log consultant_access_log[]
  consultation          consultation            @relation(fields: [consultationId], references: [id], onDelete: Cascade)
}

model equipment {
  id                 String    @id
  partyId            String    @unique
  vehicleType        String
  make               String?
  model              String?
  year               Int?
  vinNumber          String?   @unique
  plateNumber        String?
  registrationExpiry DateTime?
  party              party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
}

model inspection_issue {
  id             String   @id
  issueId        String   @unique
  inspectionDate DateTime
  inspectorName  String?
  violationCount Int      @default(0)
  outOfService   Boolean  @default(false)
  issue          issue    @relation(fields: [issueId], references: [id], onDelete: Cascade)
}

model issue {
  id               String            @id
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  issueType        String
  status           String            @default("open")
  priority         String            @default("medium")
  partyId          String
  title            String
  description      String?
  dueDate          DateTime?
  resolvedAt       DateTime?
  accident_issue   accident_issue?
  inspection_issue inspection_issue?
  party            party             @relation(fields: [partyId], references: [id])
  license_issue    license_issue?
}

model license_issue {
  id             String    @id
  issueId        String    @unique
  licenseType    String
  expirationDate DateTime
  renewalDate    DateTime?
  issue          issue     @relation(fields: [issueId], references: [id], onDelete: Cascade)
}

model organization {
  id           String         @id
  partyId      String         @unique
  name         String
  dotNumber    String?        @unique
  einNumber    String?
  address      String?
  city         String?
  state        String?
  zipCode      String?
  phone        String?
  consultation consultation[]
  party        party          @relation(fields: [partyId], references: [id], onDelete: Cascade)
}

model party {
  id           String        @id
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  status       String        @default("active")
  userId       String?
  consultant   consultant?
  equipment    equipment?
  issue        issue[]
  organization organization?
  person       person?
  role         role[]
}

model person {
  id            String    @id
  partyId       String    @unique
  firstName     String
  lastName      String
  dateOfBirth   DateTime?
  licenseNumber String?   @unique
  phone         String?
  email         String?
  address       String?
  city          String?
  state         String?
  zipCode       String?
  party         party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
}

model role {
  id             String    @id
  partyId        String
  roleType       String
  organizationId String?
  status         String    @default("pending")
  startDate      DateTime  @default(now())
  endDate        DateTime?
  isActive       Boolean   @default(true)
  expiresAt      DateTime?
  consultationId String?
  party          party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
}
